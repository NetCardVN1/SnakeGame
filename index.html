<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hungry Snake</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --glass: rgba(255, 255, 255, 0.2); --text: #444; }
        body { margin: 0; background: #e0e5ec; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        
        .glass-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 35px;
            box-shadow: 20px 20px 60px #bec3be, -20px -20px 60px #ffffff;
            padding: 40px; text-align: center; width: 300px; z-index: 10;
        }

        .title { font-size: 36px; font-weight: 800; color: var(--text); margin: 0; }
        .author { font-size: 14px; color: #777; margin-bottom: 40px; }

        .menu-btn {
            width: 100%; padding: 15px; margin: 12px 0; border: none; border-radius: 18px;
            background: rgba(255, 255, 255, 0.5); color: var(--text); font-size: 18px; font-weight: 600;
            box-shadow: 6px 6px 12px #bec3be, -6px -6px 12px #ffffff; cursor: pointer; transition: 0.2s;
        }
        .menu-btn:active { box-shadow: inset 4px 4px 8px #bec3be; transform: scale(0.97); }

        #game-view { display: none; flex-direction: column; align-items: center; }
        canvas { background: #000; border: 10px solid #fff; border-radius: 25px; box-shadow: 10px 10px 30px #bec3be; }

        .d-pad { display: grid; grid-template-columns: repeat(3, 75px); gap: 12px; margin-top: 25px; }
        .ctrl { width: 75px; height: 75px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 4px 4px 10px #bec3be; }

        .warning-text { color: #e74c3c; font-weight: bold; margin-bottom: 25px; font-size: 15px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="home" class="glass-container">
        <h1 class="title">Hungry Snake</h1>
        <p class="author">Made by Gemini and T√≠</p>
        <button class="menu-btn" onclick="show('difficulty')">Ch∆°i</button>
        <button class="menu-btn" onclick="alert('L·ªãch s·ª≠: 0 ƒëi·ªÉm')">L·ªãch s·ª≠</button>
        <button class="menu-btn" onclick="show('exit-dialog')">Tho√°t</button>
    </div>

    <div id="exit-dialog" class="glass-container hidden">
        <div class="warning-text">‚ö†Ô∏è C·∫£nh b√°o : B·∫°n c√≥ mu·ªën tho√°t tr√≤ ch∆°i kh√¥ng?</div>
        <button class="menu-btn" style="color:#27ae60" onclick="window.close()">‚úÖ ƒê√∫ng, t√¥i mu·ªën tho√°t</button>
        <button class="menu-btn" style="color:#e74c3c" onclick="show('home')">‚ùå Kh√¥ng, t√¥i mu·ªën ch∆°i ti·∫øp</button>
    </div>

    <div id="difficulty" class="glass-container hidden">
        <h2 style="color:var(--text)">M·ª®C ƒê·ªò</h2>
        <button class="menu-btn" onclick="play(140)">D·ªÖ</button>
        <button class="menu-btn" onclick="play(70)">Kh√≥</button>
        <button class="menu-btn" onclick="show('home')">Quay l·∫°i</button>
    </div>

    <div id="game-view">
        <div style="margin-bottom: 15px; font-weight: bold; color: var(--text);">ƒêi·ªÉm: <span id="sc">0</span> | üçé</div>
        <canvas id="stage" width="300" height="300"></canvas>
        <div class="d-pad">
            <div style="grid-column: 2" class="ctrl" onclick="move('UP')">‚ñ≤</div>
            <div style="grid-column: 1" class="ctrl" onclick="move('LEFT')">‚óÄ</div>
            <div style="grid-column: 2" class="ctrl" onclick="move('DOWN')">‚ñº</div>
            <div style="grid-column: 3" class="ctrl" onclick="move('RIGHT')">‚ñ∂</div>
        </div>
    </div>

    <script>
        const cvs = document.getElementById('stage');
        const ctx = cvs.getContext('2d');
        let box = 20, snake, food, score, d, loop;

        function show(id) {
            document.querySelectorAll('.glass-container').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function play(s) {
            document.getElementById('difficulty').classList.add('hidden');
            document.getElementById('game-view').style.display = 'flex';
            score = 0; d = "RIGHT";
            snake = [{x: 5*box, y: 5*box}];
            food = { x: Math.floor(Math.random()*15)*box, y: Math.floor(Math.random()*15)*box };
            loop = setInterval(draw, s);
            if (Notification.permission !== 'granted') Notification.requestPermission();
        }

        function move(dir) {
            if(dir=="LEFT" && d!="RIGHT") d="LEFT";
            if(dir=="UP" && d!="DOWN") d="UP";
            if(dir=="RIGHT" && d!="LEFT") d="RIGHT";
            if(dir=="DOWN" && d!="UP") d="DOWN";
        }

        function draw() {
            ctx.fillStyle = "black"; ctx.fillRect(0,0,300,300);
            snake.forEach((p, i) => {
                ctx.fillStyle = i==0 ? "#2ecc71" : "#27ae60";
                ctx.fillRect(p.x, p.y, box-1, box-1);
            });
            ctx.fillText("üçé", food.x+2, food.y+15);

            let nX = snake[0].x, nY = snake[0].y;
            if(d=="LEFT") nX-=box; if(d=="UP") nY-=box;
            if(d=="RIGHT") nX+=box; if(d=="DOWN") nY+=box;

            // Ch·∫°m t∆∞·ªùng ch·∫øt
            if(nX<0 || nX>=300 || nY<0 || nY>=300 || snake.some(s=>s.x==nX && s.y==nY)) {
                clearInterval(loop);
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.ready.then(reg => reg.active.postMessage({type:'SEND_NOTIF'}));
                }
                alert("GAME OVER!"); location.reload(); return;
            }

            if(nX==food.x && nY==food.y) {
                score++; document.getElementById('sc').innerText = score;
                food = { x: Math.floor(Math.random()*15)*box, y: Math.floor(Math.random()*15)*box };
            } else { snake.pop(); }
            snake.unshift({x:nX, y:nY});
        }

        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
    </script>
</body>
</html>
